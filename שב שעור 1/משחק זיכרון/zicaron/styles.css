:root{
  --bg:#0f1724;
  --card-bg:#1f2937;
  --accent:#10b981;
  --card-size:calc((min(640px,100vw) - 6rem) / 4);
}
*{box-sizing:border-box;font-family:Inter,Segoe UI,Arial,sans-serif}
.game-bg{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;background-color:#071022;color:#e6eef8;transition:background 700ms ease, color 600ms ease}

/* subtle animated soft-shapes background that complements colorful emoji faces */
.game-bg::before{
  content:'';position:fixed;inset:0;z-index:-2;pointer-events:none;background:
    radial-gradient(600px 300px at 10% 20%, rgba(16,185,129,0.08), transparent 12%),
    radial-gradient(500px 250px at 90% 80%, rgba(99,102,241,0.06), transparent 10%),
    radial-gradient(420px 220px at 50% 10%, rgba(250,204,21,0.04), transparent 8%),
    linear-gradient(180deg,#071022 0%, #0f1724 100%);
  background-size:cover;transition:opacity .6s ease;
}

/* moving overlay for a bit of life */
@keyframes slowShift{from{transform:translateY(0)}to{transform:translateY(-8vh)}}
.game-bg::after{content:'';position:fixed;inset:0;z-index:-1;pointer-events:none;opacity:0.55;background:linear-gradient(45deg, rgba(255,255,255,0.01), rgba(255,255,255,0));mix-blend-mode:overlay;animation:slowShift 18s linear infinite alternate}

/* Victory and defeat themed backgrounds */
.game-bg.victory::before{
  background:
    radial-gradient(400px 200px at 10% 20%, rgba(255,110,99,0.12), transparent 12%),
    radial-gradient(520px 260px at 90% 80%, rgba(255,195,64,0.10), transparent 10%),
    radial-gradient(360px 200px at 40% 30%, rgba(102,126,234,0.08), transparent 8%),
    linear-gradient(120deg,#ffecd2 0%, #fcb69f 100%);
}

.game-bg.defeat::before{
  background:
    radial-gradient(360px 200px at 20% 70%, rgba(120,190,255,0.06), transparent 12%),
    radial-gradient(420px 220px at 80% 30%, rgba(130,255,182,0.05), transparent 10%),
    linear-gradient(180deg,#0f1724 0%, #06202a 100%);
}

.game-bg.victory::after{animation:slowShift 10s linear infinite reverse; opacity:0.9}
.game-bg.defeat::after{animation:slowShift 20s linear infinite; opacity:0.4}

/* Enhanced celebratory victory background: radiant rays + sparkles */
.game-bg.victory{
  color: #1b1b1b;
}
.game-bg.victory::before{
  /* bright warm layered radiance */
  background:
    radial-gradient(700px 320px at 10% 20%, rgba(255,183,77,0.14), transparent 12%),
    radial-gradient(620px 300px at 85% 75%, rgba(255,122,122,0.12), transparent 10%),
    radial-gradient(420px 240px at 50% 30%, rgba(255,240,140,0.10), transparent 8%),
    linear-gradient(120deg,#fff0d9 0%, #ffd6a5 40%, #ffb3a7 100%);
  mix-blend-mode: screen;
  opacity: 1;
}

/* rotating rays overlay */
.game-bg.victory::before{filter:brightness(1.02) saturate(1.05)}
.game-bg.victory::after{opacity:1}
.game-bg.victory .rays {
  position:fixed;inset:0;z-index:-1;pointer-events:none;mix-blend-mode:screen;opacity:0.9;background:repeating-conic-gradient(from 0deg, rgba(255,255,255,0.06) 0deg 6deg, rgba(255,255,255,0.0) 6deg 12deg);mask:linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.2));animation:spinRays 8s linear infinite}
@keyframes spinRays{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}

/* sparkles */
.game-bg.victory .sparkle{position:fixed;width:8px;height:8px;border-radius:50%;background:radial-gradient(circle,#fff 0%, rgba(255,255,255,0.2) 40%, transparent 60%);pointer-events:none;z-index:-1;opacity:0.9;animation:sparkleAnim 2200ms linear infinite}
@keyframes sparkleAnim{0%{transform:translateY(0) scale(0.6);opacity:0}20%{opacity:1}80%{opacity:0.6}100%{transform:translateY(-40vh) scale(1);opacity:0}}

/* make large emoji more visible for victory */
.game-bg.victory .theme-emoji-decor{opacity:0.14;right:-3vw;transform:rotate(-10deg) scale(1.08)}

/* decorative large emoji placed by JS to hint theme */
.theme-emoji-decor{position:fixed;right:-6vw;top:6vh;font-size:20vw;line-height:1;opacity:0.08;transform:rotate(-16deg);z-index: -1;pointer-events:none;text-shadow:0 10px 40px rgba(0,0,0,0.45)}

/* theme specific tweaks */
.theme-animals .game-bg::before{background-blend-mode:screen}
.theme-fruits .game-bg::before{filter:contrast(1.02) saturate(1.08)}
.theme-sweets .game-bg::before{filter:brightness(1.04) saturate(1.06)}
.theme-sea .game-bg::before{filter:hue-rotate(190deg) saturate(1.02)}

/* additional colored glow for victory state per theme */
.theme-animals.victory::after{background:linear-gradient(120deg, rgba(126,231,135,0.08), rgba(102,209,255,0.06))}
.theme-fruits.victory::after{background:linear-gradient(120deg, rgba(255,184,107,0.08), rgba(255,216,107,0.06))}
.theme-sweets.victory::after{background:linear-gradient(120deg, rgba(255,179,214,0.08), rgba(255,219,165,0.06))}
.theme-sea.victory::after{background:linear-gradient(120deg, rgba(102,209,255,0.08), rgba(126,231,135,0.06))}
.container{width:100%;max-width:920px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
.header h1{margin:0;font-size:1.6rem}
.controls{display:flex;gap:.75rem;align-items:center}
select,button{padding:.4rem .6rem;border-radius:6px;border:1px solid rgba(255,255,255,.06);background:#111827;color:var(--accent);cursor:pointer}
.controls button#muteBtn{font-size:1rem;padding:.35rem .5rem}
.status{display:flex;gap:1rem;margin-bottom:1rem}
.status-item{background:rgba(255,255,255,.02);padding:.45rem .65rem;border-radius:8px;font-weight:600}
.board{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}
.card{width:100%;aspect-ratio:1/1;perspective:1000px}
.card-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .45s cubic-bezier(.2,.9,.3,1)}
.card.flipped .card-inner{transform:rotateY(180deg)}
.card-face{position:absolute;inset:0;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:clamp(1.4rem,4vw,2.4rem);backface-visibility:hidden}
.card-front{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.03)}
.card-back{background:var(--card-bg);transform:rotateY(180deg);border:2px solid rgba(255,255,255,.02)}
.card.matched .card-inner{box-shadow:0 8px 30px rgba(16,185,129,.12);transform:none}

/* matched celebration animation */
.card.matched.celebrate{z-index:2}
.card.matched.celebrate .card-inner{animation:matchedMove 900ms ease both}
.card.matched .card-back{background:linear-gradient(180deg,#073b25,#0e6b45)}

@keyframes matchedMove{
  0% { transform: scale(1) translateY(0) rotate(0deg); box-shadow:0 8px 30px rgba(16,185,129,.12)}
  30% { transform: scale(1.08) translateY(-6px) rotate(-4deg); }
  60% { transform: scale(1.02) translateY(-12px) rotate(4deg); }
  100% { transform: scale(1) translateY(0) rotate(0deg); box-shadow:0 20px 40px rgba(16,185,129,.16)}
}
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,.6);backdrop-filter:blur(4px);z-index:10000}
.overlay.hidden{display:none}
.modal{background:#072033;padding:2rem;border-radius:12px;border:1px solid rgba(255,255,255,.04);text-align:center;min-width:260px}
.modal h2{margin:0 0 .5rem}
#playAgain{margin-top:1rem}

/* confetti */
.confetti-piece{position:fixed;z-index:5000;pointer-events:none;will-change:transform;}

/* mismatch shake animation */
.card.shake .card-inner{animation:cardShake 720ms cubic-bezier(.36,.07,.19,.97) both}
@keyframes cardShake{
  10% { transform: translateX(-6px) rotate(-6deg) }
  30% { transform: translateX(6px) rotate(6deg) }
  50% { transform: translateX(-4px) rotate(-3deg) }
  70% { transform: translateX(4px) rotate(3deg) }
  100% { transform: translateX(0) rotate(0) }
}

@media (max-width:520px){
  .board{grid-template-columns:repeat(3,1fr)}
}
